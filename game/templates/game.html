{% extends "base.html" %}
{% comment %}

Copyright 2011 Lucas Clemente Vella
Software under Affero GPL license, see LICENSE.txt

{% endcomment %}
{% block title %}In-Game{% endblock %}
{% block css %}
	{{block.super}}
	<link rel="stylesheet" media="screen" type="text/css" href="/static/css/game.css" />
{% endblock %}
{% block content %}
<script>
	var params = {
	"game_id": {{ game_id }},
	"state": {{ state }},
	"seq_num": {{ seq_num }},
	"last_change": "{{ last_change }}",
	"channel": "{{ channel }}"{% if fb_other %},
	"fb_other": "{{ fb_other }}"{% endif %}{% if p1_last_move %},
	"p1_last_move": "{{ p1_last_move }}"{% endif %}{% if p2_last_move %},
	"p2_last_move": "{{ p2_last_move }}"{% endif %}{% if mine %},
	"mine": "{{ mine }}"{% endif %}{% if player %},
	"player": {{ player }}{% if bomb_used %},
	"bomb_used": true{% endif %}{% endif %}
	};
</script>
<script src="/static/js/game.js"></script>

<div id="main">
	<div class="box" id="p1_pts_box"><img src="/static/images/ruby.png"/> <span id="p1_pts">0</span></div>
	<div class="box" id="h_pts_box"><span id="h_pts">51</span></div>
	<div class="box" id="p2_pts_box"><span id="p2_pts">0</span> <img src="/static/images/saphire.png"/></div>
	<div id="game_box" class="box">
		<canvas id="game_canvas" style="visibility: hidden" width="416" height="416">
			Atualize seu navegador.
		</canvas>
	</div>
	<div class="box" id="p1_box"></div>
	<div class="box" id="p2_box">{% if player and state == 0 %}Aguardando...{% endif %}</div>
	<div class="box"></div>
</div>

<!-- TODO: Have button to disable the audio. -->
<audio id="ring" preload="auto">
<source src="/static/sound/ring.mp3" type="audio/mpeg" />
<source src="/static/sound/ring.ogg" type="audio/ogg" />
<source src="/static/sound/ring.wav" type="audio/wav" />
</audio>
<img id="bomb" style="visibility:hidden;" src="/static/images/bomb.png" />
<div id="notification">
	{% if not player %}<p>Modo espectador.</p>
	{% endif %}<p id="message">{% if player and state == 0 %}Envie <a href="{% url 'game.views.join_game' game_id %}{% if token %}?token={{ token }}{% endif %}">este link</a> ao seu parceiro para que ele possa entrar no jogo.<br />
	{% endif %}</p>
	<!-- TODO: Make notification stuff always visible -->

	<span id="brag_button" style="visibility:hidden" onclick="publish_results()">Publicar resultado.</span>
</div>

<!--
TODO: Place this together with the enable/disable sound button.
<script>
if(nt && nt.checkPermission() == 1)
document.write('<span onclick=\"nt.requestPermission();\">Clique para permitir notificação.</span>');
</script>
-->

{% endblock %}
